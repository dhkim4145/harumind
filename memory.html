<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>í•˜ë£¨ë§ˆìŒ - ê°™ì€ ê·¸ë¦¼ ì°¾ê¸°</title>

<style>
:root{
  --bg:#0b1020;
  --text:#e8ecff;
  --muted:#b9c2ff;
  --accent:#6ee7b7;
  --shadow:0 10px 25px rgba(0,0,0,.35);
  --radius:18px;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
  background: radial-gradient(1200px 800px at 30% 10%, #1b2457 0%, var(--bg) 55%, #050813 100%);
  color:var(--text);
  display:flex;
  justify-content:center;
  padding:18px;
}
.wrap{
  width:min(560px,100%);
  display:flex;
  flex-direction:column;
  gap:14px;
}
.card{
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  border:1px solid rgba(255,255,255,.08);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
}
.titleRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.title{font-size:20px;font-weight:900;}
.ver{font-size:12px;color:var(--muted);}
.sub{font-size:14px;color:var(--muted);margin-top:4px;}
.stats{
  display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;
}
.pill{
  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.12);
  border-radius:999px;
  padding:6px 12px;
  font-size:14px;
}
.controls{
  display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;
}
button,select{
  font-size:16px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(255,255,255,.08);
  color:var(--text);
  padding:10px 14px;
  cursor:pointer;
}
button.primary{
  background:rgba(110,231,183,.18);
  border-color:rgba(110,231,183,.45);
}

#msg{
  font-size:18px;
  font-weight:900;
}
#hint{
  font-size:14px;
  color:var(--muted);
  margin-top:4px;
}

.board{
  display:grid;
  gap:12px;
}
.tile{
  height:90px;
  border-radius:18px;
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  border:1px solid rgba(255,255,255,.12);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:42px;
  cursor:pointer;
  user-select:none;
  position:relative;
}
.tile[data-state="down"]::after{content:"?";font-weight:900;}
.tile[data-state="up"]::after{content:attr(data-emoji);}
.tile.matched{
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(110,231,183,.35) inset;
}

/* ë°©ë²• ë³´ê¸° íŒì—… */
.modalBack{
  position:fixed; inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:50;
}
.modal{
  background:#1a2250;
  border-radius:18px;
  padding:20px;
  max-width:520px;
}
.modalTitle{font-size:20px;font-weight:900;}
.modalBody{
  margin-top:12px;
  font-size:18px;
  line-height:1.85;
  color:#eef2ff;
}

/* âœ… ë§ì·„ì„ ë•Œ ë³´ìƒ ì—°ì¶œ */
.reward{
  position:fixed; /* í™”ë©´ ê¸°ì¤€(ì •í™•í•œ ìœ„ì¹˜) */
  font-size:22px;
  font-weight:900;
  color:var(--accent);
  pointer-events:none;
  animation: rewardPop 0.9s ease-out forwards;
  text-shadow:0 2px 8px rgba(0,0,0,.45);
  z-index:70;
}
@keyframes rewardPop{
  0%   { opacity:0; transform:translate(-50%, 10px) scale(0.6); }
  30%  { opacity:1; transform:translate(-50%, 0) scale(1.15); }
  100% { opacity:0; transform:translate(-50%, -18px) scale(1); }
}

/* âœ… ì™„ë£Œ ë§ˆì¼ë“œ íŒì—… */
.finishBack{
  position:fixed; inset:0;
  background:rgba(0,0,0,.35);
  z-index:90;
  opacity:0;
  animation: dimIn 0.6s ease-out forwards;
}
.finishCard{
  position:fixed;
  left:50%; top:28%;
  transform:translateX(-50%);
  z-index:100;

  width:min(420px, calc(100% - 36px));
  background:#1a2250;
  border:1px solid rgba(110,231,183,.45);
  border-radius:22px;
  box-shadow:0 18px 48px rgba(0,0,0,.55);
  padding:18px 20px;
  text-align:center;

  opacity:0;
  animation: cardPop 1.1s ease-out forwards;
}
.finishCard .big{
  font-size:22px;
  font-weight:900;
}
.finishCard .small{
  margin-top:8px;
  font-size:14px;
  color:var(--muted);
}
.finishCard .actions{
  margin-top:14px;
  display:flex;
  justify-content:center;
  gap:10px;
}
.finishCard .actions button{
  font-size:16px;
  border-radius:999px;
  border:1px solid rgba(110,231,183,.45);
  background:rgba(110,231,183,.18);
  color:var(--text);
  padding:10px 14px;
  cursor:pointer;
}

@keyframes dimIn{
  from{opacity:0;}
  to{opacity:1;}
}
@keyframes cardPop{
  0%   {opacity:0; transform:translateX(-50%) translateY(14px) scale(.92);}
  30%  {opacity:1; transform:translateX(-50%) translateY(0) scale(1.02);}
  100% {opacity:0; transform:translateX(-50%) translateY(-10px) scale(1);}
}
</style>
</head>

<body>
<div class="wrap">

  <!-- ìƒë‹¨ -->
  <div class="card">
    <div class="titleRow">
      <div class="title">ê°™ì€ ê·¸ë¦¼ ì°¾ê¸°</div>
      <div class="ver">v1.33</div>
    </div>
    <div class="sub">ê°™ì€ ê·¸ë¦¼ 2ê°œë¥¼ ì°¾ì•„ë³´ì„¸ìš”. ì²œì²œíˆ í•´ë„ ê´œì°®ì•„ìš”.</div>

    <div class="stats">
      <div class="pill">ì˜¤ëŠ˜ì˜ ê²Œì„ <b id="todayKey"></b></div>
      <div class="pill">ë§ì¶˜ ê°œìˆ˜ <b id="matched">0</b></div>
      <div class="pill">ì¹­ì°¬ì ìˆ˜ <b id="score">0</b></div>
    </div>

    <div class="controls">
      <!-- ë‚œì´ë„ -->
      <select id="level" title="ë‚œì´ë„ ì„ íƒ">
        <option value="2x2">ì‰¬ì›€ (2x2)</option>
        <option value="3x2" selected>ë³´í†µ (3x2)</option>
        <option value="4x3">ì–´ë ¤ì›€ (4x3)</option>
      </select>

      <!-- âœ… ì ê¹ë³´ê¸°: placeholder + ì‹¤í–‰ í›„ ë¦¬ì…‹ -->
      <select id="peekSec" title="ì ê¹ë³´ê¸° ì‹œê°„(ì„ íƒí•˜ë©´ ì‹¤í–‰)">
        <option value="" selected disabled>ì ê¹ë³´ê¸° (ì„ íƒ)</option>
        <option value="2">ì ê¹ë³´ê¸° 2ì´ˆ</option>
        <option value="3">ì ê¹ë³´ê¸° 3ì´ˆ</option>
        <option value="5">ì ê¹ë³´ê¸° 5ì´ˆ</option>
      </select>

      <button class="primary" id="newGame">ìƒˆë¡œ ì‹œì‘</button>
      <button id="howBtn">ë°©ë²• ë³´ê¸°</button>
      <button id="sfxBtn" title="íš¨ê³¼ìŒ ì¼œê¸°/ë„ê¸°">ğŸ”” íš¨ê³¼ìŒ: ì¼œê¸°</button>
    </div>
  </div>

  <!-- ë©”ì‹œì§€ -->
  <div class="card">
    <div id="msg">ê°™ì€ ê·¸ë¦¼ 2ê°œë¥¼ ì°¾ì•„ë³´ì„¸ìš”!</div>
    <div id="hint">íŒ: ë„ˆë¬´ ë¹¨ë¦¬ ëˆ„ë¥´ì§€ ì•Šì•„ë„ ë¼ìš”.</div>
  </div>

  <!-- ë³´ë“œ -->
  <div class="card">
    <div class="board" id="board"></div>
  </div>

  <!-- í‘¸í„° -->
  <div class="card" style="font-size:12px;color:var(--muted);">
    ë³¸ ì„œë¹„ìŠ¤ëŠ” ì˜ë£Œ í–‰ìœ„ê°€ ì•„ë‹ˆë©°, ì¸ì§€ ìê·¹ì„ ìœ„í•œ ë†€ì´ì…ë‹ˆë‹¤.<br/>
    í•˜ë£¨ë§ˆìŒ Â· harumind.kr
  </div>

</div>

<!-- ë°©ë²• ë³´ê¸° -->
<div class="modalBack" id="modalBack">
  <div class="modal">
    <div class="modalTitle">ê²Œì„ ë°©ë²•</div>
    <div class="modalBody">
      1) ë¬¼ìŒí‘œ(?) ì¹´ë“œë¥¼ ëˆŒëŸ¬ ê·¸ë¦¼ì„ í™•ì¸í•´ìš”.<br/>
      2) ê°™ì€ ê·¸ë¦¼ 2ê°œë¥¼ ì°¾ìœ¼ë©´ ì„±ê³µì´ì—ìš”.<br/>
      3) í‹€ë ¤ë„ ê´œì°®ì•„ìš” ğŸ˜Š ë‹¤ì‹œ í•´ë³´ë©´ ë©ë‹ˆë‹¤.<br/><br/>
      ì²˜ìŒì—” <b>ì‰¬ì›€(2x2)</b>ì´ ì¢‹ì•„ìš”.<br/>
      í•˜ë£¨ì— í•œ ë²ˆë§Œ í•´ë„ ì¶©ë¶„í•´ìš”.
    </div>
    <button style="margin-top:14px;" onclick="closeModal()">ë‹«ê¸°</button>
  </div>
</div>

<script>
const EMOJIS=["ğŸ","ğŸŒ","ğŸ‡","ğŸ“","ğŸ’","ğŸ‘","ğŸ","ğŸ‰","ğŸ¶","ğŸ±","ğŸ»","â­","ğŸŒ™","â˜€ï¸","ğŸˆ","ğŸš—"];

const board=document.getElementById("board");
const matchedEl=document.getElementById("matched");
const scoreEl=document.getElementById("score");
const msgEl=document.getElementById("msg");
const hintEl=document.getElementById("hint");
const todayKey=document.getElementById("todayKey");
const levelSel=document.getElementById("level");
const peekSel=document.getElementById("peekSec");

let first=null, lock=false, matched=0, score=0, totalPairs=0;
let peekTimer=null;

function today(){
  return new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Seoul"}).format(new Date());
}
todayKey.textContent=today();

/*** SFX (ì €ì‘ê¶Œ ê±±ì • ì—†ëŠ” ë¹„í”„í†¤) ***/
const sfxBtn = document.getElementById("sfxBtn");
const SFX_KEY = "harumind_sfx_on";
let sfxOn = (localStorage.getItem(SFX_KEY) !== "0"); // ê¸°ë³¸ ON

function renderSfx(){
  sfxBtn.textContent = sfxOn ? "ğŸ”” íš¨ê³¼ìŒ: ë„ê¸°" : "ğŸ”• íš¨ê³¼ìŒ: ì¼œê¸°";
}
renderSfx();

sfxBtn.onclick = () => {
  sfxOn = !sfxOn;
  localStorage.setItem(SFX_KEY, sfxOn ? "1" : "0");
  renderSfx();
};

function playBeep(freq=880, ms=70, gain=0.03){
  if(!sfxOn) return;
  try{
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    if(!AudioCtx) return;

    const ctx = new AudioCtx();
    const osc = ctx.createOscillator();
    const g = ctx.createGain();

    osc.type = "sine";
    osc.frequency.value = freq;

    g.gain.value = 0;
    osc.connect(g);
    g.connect(ctx.destination);

    const now = ctx.currentTime;
    g.gain.setValueAtTime(0, now);
    g.gain.linearRampToValueAtTime(gain, now + 0.01);
    g.gain.linearRampToValueAtTime(0, now + ms/1000);

    osc.start(now);
    osc.stop(now + ms/1000 + 0.02);

    osc.onended = () => ctx.close();
  }catch(e){
    // ì¡°ìš©íˆ ë¬´ì‹œ
  }
}

/*** ë³´ìƒ ì—°ì¶œ(+10) ***/
function showReward(tile, text){
  const r = document.createElement("div");
  r.className = "reward";
  r.textContent = text;

  const rect = tile.getBoundingClientRect();
  r.style.left = (rect.left + rect.width/2) + "px";
  r.style.top  = (rect.top + rect.height/2) + "px";

  document.body.appendChild(r);
  setTimeout(()=>r.remove(), 900);
}

/*** ì™„ë£Œ ë§ˆì¼ë“œ íŒì—…(ìƒˆë¡œ ì‹œì‘ ë²„íŠ¼ í¬í•¨) ***/
function showFinishPopup(title, sub){
  const back = document.createElement("div");
  back.className = "finishBack";

  const card = document.createElement("div");
  card.className = "finishCard";
  card.innerHTML = `
    <div class="big">${title}</div>
    <div class="small">${sub}</div>
    <div class="actions">
      <button id="finishRestartBtn">ìƒˆë¡œ ì‹œì‘</button>
    </div>
  `;

  document.body.appendChild(back);
  document.body.appendChild(card);

  const cleanup = () => {
    back.remove();
    card.remove();
  };

  card.querySelector("#finishRestartBtn").onclick = () => {
    cleanup();
    build();
  };

  setTimeout(()=>cleanup(), 1200);
}

function build(){
  // ì ê¹ë³´ê¸° ì§„í–‰ ì¤‘ì´ë©´ íƒ€ì´ë¨¸ ì •ë¦¬
  if(peekTimer){ clearTimeout(peekTimer); peekTimer=null; }

  board.innerHTML="";
  matched=0; score=0;
  matchedEl.textContent=0; scoreEl.textContent=0;
  first=null; lock=false;

  msgEl.textContent="ê°™ì€ ê·¸ë¦¼ 2ê°œë¥¼ ì°¾ì•„ë³´ì„¸ìš”!";
  hintEl.textContent="íŒ: ë„ˆë¬´ ë¹¨ë¦¬ ëˆ„ë¥´ì§€ ì•Šì•„ë„ ë¼ìš”.";

  const level=levelSel.value;
  const map={"2x2":[2,2],"3x2":[2,3],"4x3":[3,4]};
  const [r,c]=map[level];
  totalPairs=(r*c)/2;
  board.style.gridTemplateColumns=`repeat(${c},1fr)`;

  const seed=today()+level;
  let h=0; for(let ch of seed) h=Math.imul(31,h)+ch.charCodeAt(0)|0;
  const rnd=()=> (h=Math.imul(48271,h)&2147483647)/2147483647;

  const pool=[...EMOJIS].sort(()=>rnd()-0.5).slice(0,totalPairs);
  const cards=[...pool,...pool].sort(()=>rnd()-0.5);

  cards.forEach(e=>{
    const t=document.createElement("div");
    t.className="tile";
    t.dataset.state="down";
    t.dataset.emoji=e;
    t.onclick=()=>clickTile(t);
    board.appendChild(t);
  });
}

function clickTile(t){
  if(lock||t.dataset.state==="up") return;
  t.dataset.state="up";

  if(!first){
    first=t;
    msgEl.textContent="í•˜ë‚˜ ì°¾ì•˜ì–´ìš”. ê°™ì€ ê·¸ë¦¼ì„ ì°¾ì•„ë³¼ê¹Œìš”?";
    return;
  }

  lock=true;
  if(first.dataset.emoji===t.dataset.emoji){
    first.classList.add("matched");
    t.classList.add("matched");

    matched++;
    score += 10;

    // âœ… ë³´ìƒ ì—°ì¶œ
    showReward(t, "+10");

    matchedEl.textContent=matched;
    scoreEl.textContent=score;

    msgEl.textContent="ì•„ì£¼ ì¢‹ì•„ìš”!";
    hintEl.textContent="ì²œì²œíˆ í•´ë„ ì˜ í•˜ê³  ìˆì–´ìš” ğŸ™‚";

    first=null; lock=false;

    if(matched===totalPairs){
      msgEl.textContent="ì™„ë£Œ! ì •ë§ ì˜í•˜ì…¨ì–´ìš” ğŸ‰";
      hintEl.textContent="ì˜¤ëŠ˜ë„ ìˆ˜ê³ í•˜ì…¨ì–´ìš”. ë‚´ì¼ ë˜ í•´ë³¼ê¹Œìš”?";
      showFinishPopup("ì˜¤ëŠ˜ì˜ ê²Œì„ ì™„ë£Œ! ğŸ‰", "ì •ë§ ì˜í•˜ì…¨ì–´ìš”. ë‚´ì¼ë„ 5ë¶„ë§Œ í•´ë³¼ê¹Œìš”?");
      playBeep(988, 90, 0.035); // âœ… ì™„ë£Œ ì†Œë¦¬(ì•„ì£¼ ì‘ê²Œ)
    }else{
      // (ì„ íƒ) ë§ì·„ì„ ë•Œ ì•„ì£¼ ì•½í•˜ê²Œ
      playBeep(880, 55, 0.015);
    }
  }else{
    msgEl.textContent="ê´œì°®ì•„ìš” ğŸ™‚ ë‹¤ì‹œ í•´ë³´ë©´ ë©ë‹ˆë‹¤.";
    hintEl.textContent="í•œ ë²ˆ ë” ì°¾ì•„ë³¼ê¹Œìš”?";
    setTimeout(()=>{
      first.dataset.state="down";
      t.dataset.state="down";
      first=null; lock=false;
    },700);
  }
}

function doPeek(sec){
  if(lock) return;

  // âœ… ì¹´ë“œ 1ì¥ ì—´ì–´ë‘” ìƒíƒœì—ì„œ peekí•˜ë©´ first ê¼¬ì„ ë°©ì§€
  if(first){
    first.dataset.state="down";
    first=null;
  }

  lock=true;

  // ê¸°ì¡´ íƒ€ì´ë¨¸ ìˆìœ¼ë©´ ì •ë¦¬
  if(peekTimer){ clearTimeout(peekTimer); peekTimer=null; }

  const ms=sec*1000;

  [...board.children].forEach(t=>t.dataset.state="up");
  msgEl.textContent=`ì ê¹ ë³´ê³  ê¸°ì–µí•´ìš” ğŸ™‚ (${sec}ì´ˆ)`;
  hintEl.textContent="ëë‚˜ë©´ ë‹¤ì‹œ ë¬¼ìŒí‘œë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.";

  peekTimer=setTimeout(()=>{
    [...board.children].forEach(t=>!t.classList.contains("matched") && (t.dataset.state="down"));
    msgEl.textContent="ì´ì œ ì‹œì‘í•´ë³¼ê¹Œìš”?";
    hintEl.textContent="íŒ: ë„ˆë¬´ ë¹¨ë¦¬ ëˆ„ë¥´ì§€ ì•Šì•„ë„ ë¼ìš”.";
    lock=false;
    peekTimer=null;
  },ms);
}

/*** ì´ë²¤íŠ¸ ***/
document.getElementById("newGame").onclick = () => {
  build();
};

levelSel.onchange=()=>{
  build();
  msgEl.textContent="ë‚œì´ë„ë¥¼ ë°”ê¿¨ì–´ìš” ğŸ™‚ ìƒˆë¡œ ì‹œì‘í–ˆì–´ìš”.";
  hintEl.textContent="ì²œì²œíˆ í•´ë„ ê´œì°®ì•„ìš”.";
};

peekSel.onchange=()=>{
  const sec=parseInt(peekSel.value,10) || 2;
  doPeek(sec);
  // âœ… ê°™ì€ ê°’ ì¬ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ë¦¬ì…‹
  peekSel.value="";
};

function openModal(){document.getElementById("modalBack").style.display="flex";}
function closeModal(){document.getElementById("modalBack").style.display="none";}
document.getElementById("howBtn").onclick=openModal;

build();
</script>
</body>
</html>
